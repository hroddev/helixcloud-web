version: "3"

tasks:
  setup:
    desc: Install all dependencies (Frontend & API)
    cmds:
      - npm install
      - cd api && npm install

  config:
    desc: Setup environment variables from templates
    cmds:
      - test -f .env || cp .env.example .env
      - test -f infra/terraform.tfvars || cp infra/terraform.tfvars.example infra/terraform.tfvars
      - echo "Configuration files created. Please edit .env and infra/terraform.tfvars with your actual data."
    status:
      - test -f .env
      - test -f infra/terraform.tfvars

  dev:
    desc: Run development server (Astro)
    cmds:
      - npm run dev

  build:
    desc: Build for production
    cmds:
      - npm run build

  infra:init:
    desc: Initialize Terraform
    dir: infra
    cmds:
      - terraform init

  infra:plan:
    desc: Show infrastructure changes
    dir: infra
    cmds:
      - terraform plan

  infra:apply:
    desc: Deploy infrastructure
    dir: infra
    cmds:
      - terraform apply -auto-approve

  clean:
    desc: Remove build artifacts and node_modules
    cmds:
      - rm -rf dist
      - rm -rf node_modules
      - rm -rf api/node_modules
